# Key-Agreement / Acordo de Chaves
A criptografia simétrica baseia-se em shared secret-keys. O pré acordo de chaves é um processo dispendioso (requer o uso de canais secundários) e inflexivel.

Quais as alternativas?
- Considere que temos uma cifra cimetrica onde a operacao de cifra é simétrica - Ek1(Ek2(X))=Ek2(Ek1(X)).
- Ambas as partes geram uma chave secreta.
- Para A comunicar M com B ele pode:
    1. A manda EKA(M) para B (Notar que KA é apenas conhecido por A).
    2. B retorna EKB(EKA(M))=EKA(EKB(M)).
    3. A decripta a mensagem recebida and remanda para B o resultado EKB(M).
    4. B nifalmente decripta o ciphertext com a sua propria chave, obtendo M.

Neste caso, A e B comunicam de maneira segura sem trocarem chaves. No entanto, este esuqema apresenta algumas vulnerabilidades importantes, como a man-in-the-midle attack.

Este problema pode ser culmatado se ambas as partes acordarem com um segredo comum, trocando mensagens por um canal publico sem que seja possivel derivar os segredos só pelas mensagens trocadas. A segurança depende do one-wayness of modular exponentiation (da dificuldade do logaritmo discreto).

# Intermezzo: Algebraic Structures
Quando p é um numero primo, GF(p)=(Zp, +, *) é o **field** (+ e * sao respetivamentea adição e a multiplicacao de monulo p).

- As modulações inversas podem ser computacionadas com o algoritmo de Euclides. 
- Um elemento rpimitivo é o **gerador g** de um multiplo grupo(todos os elementos podem ser escritos como g^i, para um dado i).

Para n composto, (Zn, +, *) formaa um **anel**.
- Elementos com inverso multiplicativo (**unidades**) são aqueles x tais que mdc(x,
n)=1 (primos em relação a n).
- O número desses elementos é dado por φ(n) (função de Euler).

# (Believed) Hard problems
Debaixo de condições apropriadas, os seguintes problemas sao considerados dificieis:
- **Integer factorisation**: Dado um inteiro n, determinar a sua fatorização em numeros primos.
- **Discrete logarithm**: Dado a, b e n computar x dados por a^x mod n = b.
- **Discrete square-root**: Dado y e n, computar x, dado x^2 mod n = y.

# (Ephemeral) Diffie&Hellman protocol
Considerando p um número primitivo, g o gerador de um subgrupo em ordem ao primo q.

1. A escolhe random um inteiro skA=x, 1<\x<\q
(private key) e mando pkA=g^x mod p (public key) to B.
2. O B faz o mesmo processo e manda para A.
3. Shared secret: K=g^(xy) mod p = (g^y)^x mod p = (g^x)^ y mod p.

![Diffie&Hellman protocol](/Images/14-Diffie&Hellman%20protocol.png)

Como cada parte gera um par de chaves, é considerado um protocolo Ephemeral. A shared secret K nunca deve ser usado diretamente como chave criptografica. Em vez disso, deve ser derivado atraves do KDF.

# DH security wrt passive adversaries
Se o adversário istiver apto para computacionar o logaritmo discreto, ele pode computacionar x dado g^x para atacar o protocolo.

Computational Die-Hellman (CDH) problem: Para um random x e y, é infasivel um adversário PPt computar g^(xy) a partir de g^x e g^y.

# DH (in)security wrt active adversaries
Um adversário activo pode fazer-se passar por outra parte e assim comprometer o sigilo do segredo partilhado: Conhecido como ataque man-in-the-middle.

Supondo que A pretende acordar um segredo com B.
- A gera a key-pair (skA, pkA)=(x, g^x), e manda pkA para B.
- I intercepta a mensagem de A.
- I gera o seu proprio key-pair (skI, pkI)=(z, g^z), e retorna pkI para A.
- A adota o secredo K=(g^z)^x=g^(xz) que acha que foi acordado com B e I sabe que A acredita que este é o segredo que A pensa estar a ser trocado com B.

O uso da criptografia assimétrica depende de uma associação confiável entre chave pública e
partes legítimas (identidades).




